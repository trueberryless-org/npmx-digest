---
import { getCollection } from "astro:content";
import Layout from "../layouts/Layout.astro";

const posts = await getCollection("posts");

const sortedPosts = posts.sort(
  (a, b) => b.data.date.valueOf() - a.data.date.valueOf()
);

const formatDate = (date: Date) => date.toISOString().split("T")[0];
---

<Layout title="Archive | npmx.digest">
  <h1 class="page-title">Archives</h1>

  <ul class="archive-list">
    {
      sortedPosts.map(({ data, id }) => {
        const displayDate = formatDate(data.date);
        const postUrl = `/posts/${id}`;

        return (
          <li class="archive-row">
            <a href={postUrl} class="archive-item">
              <span
                class={`type ${data.type}`}
                aria-label={`Post type: ${data.type}`}
              >
                {data.type}
              </span>
              <span class="title">{data.title}</span>
              <span class="dot" aria-hidden="true" />
              <time datetime={data.date.toISOString()} class="date">
                {displayDate}
              </time>
            </a>
          </li>
        );
      })
    }
  </ul>
</Layout>

<style>
  .page-title {
    font-size: 1.2rem;
    margin-bottom: 2rem;
    color: var(--text-muted);
  }

  .archive-list {
    display: flex;
    flex-direction: column;
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .archive-row {
    width: 100%;
  }

  .archive-item {
    display: flex;
    align-items: baseline;
    padding: 0.8rem 0;
    border-bottom: 1px solid #151515;
    text-decoration: none;
    color: var(--text-muted);
    font-size: 0.95rem;
  }

  .archive-item:hover {
    color: var(--accent);
  }

  .type {
    width: 65px;
    flex-shrink: 0;
    font-size: 0.75rem;
    text-transform: capitalize;
    font-weight: 600;
    margin-right: 0.5rem;
  }

  .daily {
    color: #fbbf24;
  }
  .midday {
    color: #f97316;
  }
  .nightly {
    color: #818cf8;
  }

  .title {
    color: var(--text);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    flex-shrink: 1;
    min-width: 0;
  }

  .dot {
    align-self: center;
    flex-grow: 1;
    min-width: 20px;
    border-bottom: 1px dotted #333;
    margin: 0.2rem 0.5rem 0;
  }

  .date {
    font-family: monospace;
    width: 90px;
    text-align: right;
    flex-shrink: 0;
    font-size: 0.85rem;
  }
</style>
